<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Dashboard — IIBSE Panel</title>
  <link rel="stylesheet" href="../css/style.css" />

  <style>
    body { background:#f0f4ff; }
    .dashboard-box{
      background:#fff;padding:20px;margin:20px;
      border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.1);
    }
    .stats-container{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:20px;margin:20px;
    }
    .stat-card{
      background:#fff;padding:18px;text-align:center;border-radius:8px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
    }
    .stat-card h3{margin-bottom:8px;color:#003b73;}
    .stat-card p{font-size:24px;font-weight:bold;color:#444;}
  </style>
</head>

<body>

<header>
  <div class="logo">IIBSE School Panel</div>
</header>

<main>
  <div class="dashboard-box">
    <h2>Welcome, <span id="schoolName">Loading...</span></h2>
    <p>Status: <span id="approvalStatus"></span></p>
  </div>

  <div class="stats-container">
    <div class="stat-card">
      <h3>Total Students</h3>
      <p id="totalStudents">0</p>
    </div>

    <div class="stat-card">
      <h3>Pending Admissions</h3>
      <p id="pendingStudents">0</p>
    </div>

    <div class="stat-card">
      <h3>Unread Notices</h3>
      <p id="noticeCount">0</p>
    </div>

    <div class="stat-card">
      <h3>Pending Fees</h3>
      <p id="pendingFees">₹0</p>
    </div>
  </div>
</main>

<!-- DYNAMIC DASHBOARD SCRIPT -->
<script>
const backend = "https://iibse-website-1.onrender.com";

// Load stored name + approval
document.getElementById("schoolName").innerText = localStorage.getItem("school_name");

const approved = localStorage.getItem("approved");
document.getElementById("approvalStatus").innerText = approved === "true" ? "Approved" : "Pending Approval";
if (approved !== "true") document.getElementById("approvalStatus").style.color = "red";

// Fetch Dashboard Stats
async function loadDashboardData() {
    const schoolId = localStorage.getItem("school_id");

    try {
        const res = await fetch(`${backend}/school/dashboard-data?school_id=${schoolId}`);
        const data = await res.json();

        document.getElementById("totalStudents").innerText = data.totalStudents;
        document.getElementById("pendingStudents").innerText = data.pendingStudents;
        document.getElementById("noticeCount").innerText = data.noticeCount;
        document.getElementById("pendingFees").innerText = "₹" + data.pendingFees;

    } catch (err) {
        console.log("Dashboard Load Error:", err);
    }
}

loadDashboardData();
</script>

<script src="../js/session-school.js"></script>
<script>checkSchoolSession();</script>

</body>
</html>
