<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Student List â€” IIBSE School Panel</title>
<link rel="stylesheet" href="../css/style.css">

<style>
  body { background:#f0f4ff; }

  .container {
    max-width: 1100px;
    margin: 20px auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  h2 { color:#003b73; margin-bottom: 15px; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }

  th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }

  th {
    background: #003b73;
    color: white;
  }

  .status-pending { color: red; font-weight: bold; }
  .status-approved { color: green; font-weight: bold; }

  .btn-pay {
    background: #28a745;
    padding: 6px 12px;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    border: none;
  }

  .btn-view {
    background: #007bff;
    padding: 6px 12px;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    border: none;
  }
</style>
</head>

<body>

<header>
  <div class="logo">IIBSE School Panel</div>
</header>

<div class="container">
  <h2>Your Students</h2>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Class / Course</th>
        <th>Admission Type</th>
        <th>Referral ID</th>
        <th>Status</th>
        <th>Fee</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="studentList">
      <tr><td colspan="7" style="text-align:center;">Loading...</td></tr>
    </tbody>
  </table>
</div>

<script>
const backend = "https://iibse-website-1.onrender.com";

async function loadStudents() {
    const schoolId = localStorage.getItem("school_id");

    try {
        const res = await fetch(`${backend}/school/students?school_id=${schoolId}`);
        const data = await res.json();

        const table = document.getElementById("studentList");
        table.innerHTML = "";

        if (!data || data.length === 0) {
            table.innerHTML = `<tr><td colspan="7" style="text-align:center;">No students found.</td></tr>`;
            return;
        }

        data.forEach(stu => {
            const statusClass = stu.status === "approved" ? "status-approved" : "status-pending";
            const feeBtn = stu.fee_pending ? `<button class="btn-pay">Pay Now</button>` : "Paid";

            table.innerHTML += `
                <tr>
                    <td>${stu.student_name}</td>
                    <td>${stu.class_course}</td>
                    <td>${stu.admission_type}</td>
                    <td>${stu.referral_id || "-"}</td>
                    <td class="${statusClass}">${stu.status}</td>
                    <td>${feeBtn}</td>
                    <td><button class="btn-view">View</button></td>
                </tr>
            `;
        });

    } catch (err) {
        document.getElementById("studentList").innerHTML =
            `<tr><td colspan="7" style="text-align:center;color:red;">Error loading students.</td></tr>`;
    }
}

loadStudents();
</script>

<script src="../js/session-school.js"></script>
<script>checkSchoolSession();</script>

</body>
</html>
